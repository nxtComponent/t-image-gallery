<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-image/iron-image.html">
<link href="../iron-icons/iron-icons.html" rel="import">
<link href="../iron-media-query/iron-media-query.html" rel="import">
<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="../slick-carousel/slick/slick.min.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.css"></link>
<link rel="stylesheet" type="text/css" href="../slick-carousel/slick/slick-theme.css"></link>
<dom-module id="t-image-corousel">
	<template>
		<style>
		:host {
			display: block;
			font-family: 'Roboto';
			position: relative;
			height: 100%;
			width: 100%;
		}
		#previewSlider .slick-current{
			border: solid 2px blue;
		}
		.overlay{
			z-index:999;
			background: transparent;
			width: 100%;
			height: 100%;
			position: fixed;
		}
		#previewSlider{
			width: 100%;
			position: absolute;
			bottom: 0;
			overflow: hidden;
			padding: 10px 0;
		}
		.grid {
			display: -ms-flexbox;
			-ms-flex-wrap: wrap;
			-ms-flex-direction: column;
			-webkit-flex-flow: row wrap;
			flex-flow: row wrap;
			display: -webkit-box;
			display: flex;
		}

		[hidden]{
			display: none!important;
		}

		.grid{
			width: 100%;
			height: 100%;
		}
		.grid div {
			-webkit-box-flex: auto;
			-ms-flex: auto;
			flex: auto;
			width: calc(33% - 6px);
			height: 50%;
			margin: 2px;
		}
		.grid div img {
			width: 100%;
			height: 100%;
		}

		@media screen and (max-width: 1024px) {
			.grid > div {
				width: 240px;
			}
		}

		@media screen and (max-width: 400px) {
			.grid > div { margin: 0; height: 100%;  }
			.grid { padding: 0;  }
		}

		.slic-next{
			width: 40px;
			height: 40px;
			position: absolute;
			right: 50px;
			top: 50%;
			color: white;
		}

		/*.slick-slide{*/
		/*opacity: 0.3;*/
		/*vertical-align: middle;*/
		/*}*/
		/*.slick-current{*/
		/*opacity: 1;*/
		/*}*/
		/*.slick-slide {*/
		/*text-align: center;*/
		/*}*/

		/*.slick-slide::before {*/
		/*content: '';*/
		/*display: inline-block;*/
		/*height: 100%;*/
		/*vertical-align: middle;*/
		/*}*/

		/*.slick-slide {*/
		/*vertical-align: middle;*/
		/*display: inline-block;*/
		/*}*/

		.slic-prev{
			width: 40px;
			height: 40px;
			position: absolute;
			left: 50px;
			top: 50%;
			z-index: 1200;
			color: white;
		}

		.slider-header{
			height: 60px;
			padding: 20px 16px;
			position: relative;
		}

		.slider-header h1{
			font-size: 18px;
			font-weight: 600;
		}

		.action-bar{
			position: relative;
			text-align: center;
		}

		.action-bar h1{
			margin: 0;
			display: inline-block;
		}

		.slider-header paper-button{
			background-color:#1976d3;
		}

		.close{
			position: absolute;
			z-index: 1000;
			right: 0;
		}

		.lightbox {
			position: fixed;
			color: #e5e6ea;
			max-width: 1200px;
			max-height: 1000px;
			width: 100%;
			top: 20px;
			height: calc(100% - 40px);
			max-: calc(100% - 40px);
			background-color: rgba(66,77,81, 0.8);
			margin: 0 auto;
			transform: translateX(-50%);
			left: 50%;
			z-index: 1000;
		}

		.lightbox .lb-images {
			display: block;
			position: relative;
			height: calc(100% - 250px);
			max-height: calc(100% - 250px);
		}

		.lightbox #carousel{
			height: 100%;
			width: calc(100% - 198px);
			margin: 0 auto;
			overflow: hidden;
		}

		.lightbox #carousel img{
			margin: 0 6px;
		}

		#previewSlider img {
			width: 75px !important;
			height: 75px !important;
			margin: 0 6px;
		}

		.pagination-bar{
			position: absolute;
			bottom: 16px;
			left: 99px;
		}
		@media (max-width: 1024px) and (min-width: 768px){
		}

		@media (min-width : 320px) and (max-width : 767px) {
			.lightbox #carousel{
				width: 100%;
				height: calc(100% -60px);
			}
			.action-bar h1{
				margin: 5px;
			}

			.lightbox .lb-images{
				height: calc(100% - 140px);
				max-height: calc(100% - 140px);
			}

			.lightbox{
				height:100%;
				top:0;
			}
			.pagination-bar{
				left: 10px;
				bottom: 10px;
			}

			.slic-next{
				right: 20px;
			}
			.slider-header{
				height: 80px;
			}
			.slic-prev{
				left: 20px;
			}
		}

		</style>

		<iron-media-query query="(min-width : 320px) and (max-width : 767px)" query-matches="{{_isMobile}}"></iron-media-query>
		<iron-media-query query="(max-width: 1024px) and (min-width: 768px)" query-matches="{{_isTablet}}"></iron-media-query>


		<template is="dom-if" if="[[_isInGridMode]]">
			<div class="grid" >
				<template is="dom-if" if="[[_isDesktop(_isMobile, _isTablet)]]">
					<template is="dom-repeat" items="[[images]]" filter="_isInFirstFive" >
						<div><img on-click="_gotoSlide" data-index$="[[index]]" src="[[item.url]]" alt></div>
					</template>
				</template>

				<template is="dom-if" if="[[_isTablet]]" filter="_isInFirstFour" >
					<template is="dom-repeat" items="[[images]]" filter="_isInFirstFour" >
						<div><img on-click="_gotoSlide" data-index$="[[index]]" src="[[item.url]]" alt></div>
					</template>
				</template>

				<template is="dom-if" if="[[_isMobile]]" >
					<div><img on-click="_gotoSlide" data-index="0" src="[[images.0.url]]" alt></div>
				</template>
			</div>
		</template>

		<div class="overlay" on-tap="_closeSlider">
			<div class="lightbox" hidden$="[[_isInGridMode ]]">
				<paper-icon-button class="close" on-tap="_closeSlider" icon="close" ></paper-icon-button>
				<div class="slider-header">
					<div class="action-bar">
						<h1>Mandarin Hotel, Las Vegas </h1>
						<paper-button raised class="indigo" > Reserve Now</paper-button>
					</div>
					<div class="pagination-bar">[[_paging]]</div>

				</div>
				<div class="lb-images">
					<div id="carousel" class="lb-slides">
						<template is="dom-repeat" items="[[images]]" >
							<img data-index$="[[index]]" data-lazy$="[[item.url]]" src="[[item.url]]" />
						</template>
					</div>
				</div>
				<template is="dom-if" if="[[!_isMobile]]">
					<div id="previewSlider" >
						<template is="dom-repeat" items="[[images]]" >
							<img on-tap="_gotoSlide" data-index$="[[index]]" src="[[item.url]]">
						</template>
					</div>
				</template>
			</div>
		</div>

	</template>

	<script>
	/**
	* `t-image-corousel`
	*
	*
	* @customElement
	* @polymer
	* @demo demo/index.html
	*/
	class TImageCorousel extends Polymer.Element {
		static get is() { return 't-image-corousel'; }

		static get properties() {
			return {
				showSingle: {
					type: Boolean,
					value: false
				},
				images: {
					type: Array,
					value:  function(){
						return [
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/2400x1600&sig=123", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=17", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=26", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=25", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=24", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=23", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=22", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=21", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600&sig=20", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x600&sig=99", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x600", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x1600", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/800x600", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/600x600", "category" : "room" },
							{ "caption" : "image caption", "url" : "https://source.unsplash.com/random/400x600", "category" : "room" }
						];
					}
				},
				previewDefaults: {
					type: Object,
					value: function(){
						return {
							centerMode: true,
							focusOnSelect:true,
							slidesToScroll:5,
							slidesToShow: 13,
							arrows: false,
							mobileFirst: true,
							responsive:[
								{
									breakpoint: 1025,
									settings: {
										slidesToShow: 13,
									}
								},
								{
									breakpoint: 767,
									settings: {
										slidesToShow: 6
									}
								},
								{
									breakpoint: 480,
									settings: {
										slidesToShow: 1
									}
								}
							]
						};
					}
				},
				slickDefaults: {
					type: Object,
					value: function() {
						return {
							slidesToShow: 3,
							lazyLoad: 'ondemand',
							infinite: true,
							slickGoTo: 0,
							slidesToScroll: 1,
							slidesToScroll: 5,
							variableWidth: true,
							focusOnSelect: false,
							nextArrow:'<paper-icon-button icon="arrow-forward" class="slic-next" ></paper-icon-button>',
							prevArrow: '<paper-icon-button primary icon="arrow-back" class="slic-prev" ></paper-icon-button>',
							speed: 600,
							centerMode: true,
							arrows: true,
							responsive: [
								{
									breakpoint: 1024,
									settings: {
										slidesToShow: 3,
									}
								},
								{
									breakpoint: 767,
									settings: {
										slidesToShow: 2
									}
								},
								{
									breakpoint: 480,
									settings: {
										slidesToShow: 1
									}
								}
							]
						};
					}
				},
				_isDesktop: Boolean,
				_isTablet: Boolean,
				_isInGridMode: {
					type: Boolean,
					value: true
				}
			}
		}

		_gotoSlide(e){
			let index = parseInt( e.target.getAttribute('data-index'));
			var el = this.$.carousel;
			this._isInGridMode = false;
			jQuery(el).slick('slickGoTo', index);
			if(!this._isMobile)
			jQuery(this.$.previewSlider).slick('slickGoTo', index);
		}

		ready(){
			super.ready();
			var slider = this;
			setTimeout(function(){
				var mainSlider = slider.$.carousel;
				jQuery(mainSlider).slick(slider.slickDefaults);
				jQuery(mainSlider).on('setPosition', function(event, slick, direction){
					slider._paging = (slick.currentSlide + 1) + "/" + slider.images.length;
					if(!this._isMobile)
					jQuery(slider.$.previewSlider).slick('slickGoTo', slick.currentSlide);
				});

				if(!this._isMobile)
				jQuery(slider.$.previewSlider).slick(slider.previewDefaults);
			}, 0);
		}

		_isDesktop(isMobile, isTablet){
			return (!isMobile && !isTablet);
		}

		_isInFirstFive(item){
			return this.images.indexOf(item) <= 4;
		}

		_isInFirstFour(item){
			return this.images.indexOf(item) <= 3;
		}

		_closeSlider(	e){
			if(e.target.classList.value === 'overlay' || e.target.classList.value === 'close')
			this._isInGridMode = true;
		}

	}

	customElements.define(TImageCorousel.is, TImageCorousel);
	</script>
</dom-module>

